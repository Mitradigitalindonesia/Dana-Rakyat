<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profil Akun</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg-main: #f5f6fa;
  --card-bg: #ffffff;
  --text-main: #2c3e50;
  --text-subtle: #7f8c8d;
  --primary: #3498db;
  --primary-dark: #2980b9;
  --success: #27ae60;
  --error: #e74c3c;
  --border: #dcdde1;
}

/* Reset */
* { box-sizing: border-box; margin:0; padding:0; }
body {
  font-family: 'Inter', sans-serif;
  background: var(--bg-main);
  color: var(--text-main);
  font-size: 14px;
  line-height: 1.5;
}

/* Container */
.container {
  max-width: 500px;
  margin: 40px auto 80px;
  padding: 0 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Avatar & Username */
.profile-header {
  text-align: center;
  margin-bottom: 30px;
}

.profile-avatar {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  object-fit: cover; /* memastikan gambar menyesuaikan div */
  margin-bottom: 9px;
  display: block;
}

.username {
  font-size: 14px;
  font-weight: 500;
  color: var(--text-main);
}

/* Card */
.card {
  background: var(--card-bg);
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  padding: 24px 20px;
  margin-bottom: 20px;
  width: 100%;
  max-width: 460px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
}
.card:hover { box-shadow: 0 8px 25px rgba(0,0,0,0.12); }

.card h3 {
  font-size: 14px;
  margin-bottom: 16px;
  color: var(--text-subtle);
  font-weight: 600;
  border-bottom: 1px solid #eee;
  padding-bottom: 8px;
}

/* Card Content (label/value) */
.card p {
  font-size: 12px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.card p span {
  font-weight: 500;
  color: var(--text-subtle);
  text-align: right;
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.5);
  align-items: center;
  justify-content: center;
  z-index: 2000;
}

.modal-content {
  background: #fff;
  border-radius: 16px;
  padding: 28px 24px;
  width: 90%;
  max-width: 400px;
  max-height: 90%;
  overflow-y: auto;
  position: relative;
}

.modal-content h3 {
  margin-bottom: 16px;
  font-weight: 600;
  color: var(--text-main);
}

.modal-content label {
  display: block;
  margin-bottom: 4px;
  font-weight: 500;
  color: var(--text-subtle);
  font-size: 12px;
}

.modal-content input {
  width: 100%;
  padding: 10px 12px;
  margin-bottom: 14px;
  border: 1px solid #ccc;
  border-radius: 12px;
  font-size: 14px;
  transition: border-color 0.2s;
}
.modal-content input:focus {
  border-color: var(--primary);
  outline: none;
}

.modal-content button {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: none;
  background: var(--primary);
  color: #fff;
  font-weight: 600;
  font-size: 15px;
  cursor: pointer;
  transition: background 0.2s;
}
.modal-content button:hover { background: var(--primary-dark); }

.modal-close {
  position: absolute;
  top:10px; right:12px;
  font-size:14px;
  cursor: pointer;
  color: var(--text-subtle);
}

/* Logout */
.logout-btn {
  max-width: 460px;
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: #fff;
  font-weight: 500;
  font-size: 14px;
  margin-top: 20px;
  cursor: pointer;
  transition: all 0.2s;
}
.logout-btn:hover {
  background: var(--primary);
  color: #fff;
  border-color: var(--primary);
}
/* Bottom nav */
.bottom-nav { position:fixed; bottom:0; left:0; right:0; background:var(--card-bg); border-top:1px solid var(--border); display:flex; justify-content:space-around; padding:10px 0; z-index:1000; }
.bottom-nav a { color:var(--text-subtle); text-align:center; font-size:11px; text-decoration:none; display:flex; flex-direction:column; align-items:center; }
.bottom-nav a.active, .bottom-nav a:hover { color:var(--highlight); }
.bottom-nav a svg { width:24px; height:24px; margin-bottom:4px; }
*::before,
*::after {
  box-sizing: border-box;
}
</style>
</head>
<body>

<div class="container">

  <!-- Avatar & Username -->
  <div class="profile-header">
   <img class="profile-avatar" id="avatar" src="avatar.jpg" alt="Avatar">
    <div class="username" id="username">User Name</div>
  </div>

  <!-- Container Detail Akun -->
  <div class="card" id="account-card">
    <h3>Detail Akun (KTP)</h3>
    <p>Nama Panggilan: <span id="display-nama">-</span></p>
    <p>Nama Lengkap: <span id="display-nama_lengkap">-</span></p>
    <p>NIK: <span id="display-nik">-</span></p>
    <p>No HP: <span id="display-no_hp">-</span></p>
  </div>

  <!-- Container Data Bank -->
  <div class="card" id="bank-card">
    <h3>Data Bank</h3>
    <p>Nama Bank: <span id="display-nama_bank">-</span></p>
    <p>No Rekening: <span id="display-no_rekening">-</span></p>
    <p>Nama Pemilik: <span id="display-nama_pemilik_rekening">-</span></p>
  </div>

  <!-- Logout -->
  <button class="logout-btn" id="logout">Keluar</button>
</div>

<!-- Modal Popup -->
<div class="modal" id="modal">
  <div class="modal-content">
    <span class="modal-close" id="modal-close">&times;</span>
    <h3 id="modal-title">Edit Data</h3>
    <div id="modal-body"></div>
    <button id="modal-save">ðŸ’¾ Simpan</button>
  </div>
</div>
<!-- Bottom Nav -->
<div class="bottom-nav">
  <a href="dashboard.html"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2"><path d="M4 10L12 3l8 7"></path><path d="M5 11v9a1 1 0 001 1h4v-6h4v6h4a1 1 0 001-1v-9"></path></svg><span>Home</span></a>
  <a href="akun.html"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2"><circle cx="12" cy="8" r="4"></circle><path d="M4 20c0-4 4-6 8-6s8 2 8 6"></path></svg><span>Akun</span></a>
  <a href="dompet.html"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2"><path d="M2 7a2 2 0 012-2h16a1 1 0 011 1v2H4a2 2 0 00-2 2v8a2 2 0 002 2h16a2 2 0 001-1v-2h-6a2 2 0-2-2v-2a2 2 0-2-2h6V6a3 3 0-3-3H4a3 3 0-2 2.83V7z"></path><circle cx="18" cy="12" r="1"></circle></svg><span>Dompet</span></a>
  <a href="mitra.html"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2"><path d="M4 12l4-4 4 4-4 4-4-4z"></path><path d="M20 12l-4-4-4 4 4 4 4-4z"></path></svg><span>Mitra</span></a>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
const SUPABASE_URL = 'https://kibcrltcznvkbssgrinw.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtpYmNybHRjem52a2Jzc2dyaW53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5NzAyNDksImV4cCI6MjA3MjU0NjI0OX0.LOX9fn-w1VwqiQJA4QxXsHResIQeVHf-0Rygn_x8U2w';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
let currentModal = ''; 

async function loadData() {
  const { data: { session } } = await supabase.auth.getSession();
  if (!session?.user) { window.location.href = "login.html"; return; }
  const userId = session.user.id;
  const { data } = await supabase.from('users')
    .select(`nama,nama_lengkap,nik,no_hp,nama_bank,no_rekening,nama_pemilik_rekening`)
    .eq('id', userId).single();

  if (data) {
    document.getElementById('display-nama').textContent = data.nama || '-';
    document.getElementById('display-nama_lengkap').textContent = data.nama_lengkap || '-';
    document.getElementById('display-nik').textContent = data.nik || '-';
    document.getElementById('display-no_hp').textContent = data.no_hp || '-';
    const username = data.nama || data.nama_lengkap || 'User';
    document.getElementById('username').textContent = username;
    document.getElementById('avatar').textContent = username.charAt(0).toUpperCase();
    document.getElementById('display-nama_bank').textContent = data.nama_bank || '-';
    document.getElementById('display-no_rekening').textContent = data.no_rekening || '-';
    document.getElementById('display-nama_pemilik_rekening').textContent = data.nama_pemilik_rekening || '-';
  }
}

function openModal(type) {
  currentModal = type;
  const modal = document.getElementById('modal');
  const body = document.getElementById('modal-body');
  body.innerHTML = '';
  if (type === 'account') {
    document.getElementById('modal-title').textContent = 'Edit Detail Akun';
    ['nama','nama_lengkap','nik','no_hp'].forEach(id => {
      const label = document.createElement('label');
      label.textContent = id.replace('_',' ').toUpperCase();
      const input = document.createElement('input');
      input.type = 'text';
      input.id = 'modal-' + id;
      input.value = document.getElementById('display-'+id).textContent !== '-' ? document.getElementById('display-'+id).textContent : '';
      body.appendChild(label);
      body.appendChild(input);
    });
  } else if (type === 'bank') {
    document.getElementById('modal-title').textContent = 'Edit Data Bank';
    ['nama_bank','no_rekening','nama_pemilik_rekening'].forEach(id => {
      const label = document.createElement('label');
      label.textContent = id.replace(/_/g,' ').toUpperCase();
      const input = document.createElement('input');
      input.type = 'text';
      input.id = 'modal-' + id;
      input.value = document.getElementById('display-' + id).textContent !== '-' ? document.getElementById('display-' + id).textContent : '';
      body.appendChild(label);
      body.appendChild(input);
    });
  }
  modal.style.display = 'flex';
}

document.getElementById('modal-close').addEventListener('click', ()=> { document.getElementById('modal').style.display = 'none'; });

document.getElementById('account-card').addEventListener('click', e => { if(!e.target.closest('button')) openModal('account'); });
document.getElementById('bank-card').addEventListener('click', e => { if(!e.target.closest('button')) openModal('bank'); });

document.getElementById('modal-save').addEventListener('click', async ()=> {
  const { data: { session } } = await supabase.auth.getSession();
  const userId = session?.user?.id;
  if (!userId) return;
  let payload = {};
  if (currentModal === 'account') {
    payload = {
      nama: document.getElementById('modal-nama').value,
      nama_lengkap: document.getElementById('modal-nama_lengkap').value,
      nik: document.getElementById('modal-nik').value,
      no_hp: document.getElementById('modal-no_hp').value
    };
  } else if (currentModal === 'bank') {
    payload = {
      nama_bank: document.getElementById('modal-nama_bank').value,
      no_rekening: document.getElementById('modal-no_rekening').value,
      nama_pemilik_rekening: document.getElementById('modal-nama_pemilik_rekening').value
    };
  }
  const { error } = await supabase.from('users').update(payload).eq('id', userId);
  if (error) alert('Gagal menyimpan data!');
  else { document.getElementById('modal').style.display = 'none'; loadData(); }
});

document.getElementById('logout').addEventListener('click', async () => { await supabase.auth.signOut(); window.location.href = "login.html"; });
document.addEventListener('DOMContentLoaded', loadData);
</script>
</body>
</html>
